<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="">
  <meta name="author" content="">
  <title>(S)IGNIS</title>
  <link href="../static/css/style.sass" rel="stylesheet">
  <!-- Bootstrap core CSS-->
  <link href="../static/css/bootstrap.min.css" rel="stylesheet">
  <!-- Custom fonts for this template-->
  <link href="../static/vendor/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/all.css" integrity="sha384-UHRtZLI+pbxtHCWp1t77Bi1L4ZtiqrqD80Kn4Z8NTSRyMA2Fd33n5dQ8lWUE00s/" crossorigin="anonymous">
  <!-- Custom styles for this template-->
  <link href="../static/css/sb-admin.css" rel="stylesheet">
  <link href="../static/css/ol.css" rel="stylesheet">
  <!-- ol-ext -->
  <link rel="stylesheet" href="https://cdn.rawgit.com/Viglino/ol-ext/master/dist/ol-ext.min.css" />

  <link rel="stylesheet" href="../static/css/ol-geocoder.min.css">
  <link href="https://cdn.jsdelivr.net/npm/ol-contextmenu@latest/dist/ol-contextmenu.min.css" rel="stylesheet">
  
  <link rel="stylesheet" href="https://unpkg.com/ol-popup@3.0.0/src/ol-popup.css" />
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <!-- ANGULAR MATERIAL -->
  <link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/angular_material/1.1.8/angular-material.min.css">
  <!-- Angular Material requires Angular.js Libraries -->
  <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.9/angular.min.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.9/angular-animate.min.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.9/angular-aria.min.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.9/angular-messages.min.js"></script>
  <!-- Angular Material Library -->
  <script src="https://ajax.googleapis.com/ajax/libs/angular_material/1.1.8/angular-material.min.js"></script>

  <!-- jsPanel CSS -->
  <link href="https://cdn.jsdelivr.net/npm/jspanel4@4.0.0/dist/jspanel.css" rel="stylesheet">

	<script src="https://cdnjs.cloudflare.com/ajax/libs/proj4js/2.4.1/proj4.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/proj4js/2.4.1/proj4-src.js"></script>
          <!-- JS -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script> 
  <script src="https://use.fontawesome.com/c79e2f3459.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.4/angular-route.js"></script>
  <script src="https://unpkg.com/jspdf@latest/dist/jspdf.min.js"></script>
  <!-- OL-ext -->
<link rel="stylesheet" href="../static/dist/ol-ext.css" />
  <style>
  
  .navbar-expand-lg .navbar-nav .nav-link{
    padding-left: 5px;
    font-size: 18px;
  }
  body {
    font-size: 0.75rem;
    
  }
  #collapseComponents11 {
      margin-bottom: 0;
      margin-left: -40px;
  }
  #collapseComponents12 {
      margin-bottom: 0;
      margin-left: -40px;
  }
  .navbar-brand {
    display: block;
padding-top: .3125rem;
padding-bottom: .3125rem;
margin-right: 1rem;
font-size: 1.25rem;
line-height: inherit;
white-space: nowrap;
margin-left: 15px;
position: relative;
float: left;
}
.ol-popup {
    background-color: rgba(0,0,0,0.75);
    color: black;
    text-align: center;
    border-radius: 6px;
    padding: 8px 0;
    display: inline-flex;
    width: auto;
}
.ol-popup-content {
    border: 0px;
    padding: 0;
}
.tooltip {
        position: relative;
        background: rgba(0, 0, 0, 0.5);
        border-radius: 4px;
        color: white;
        padding: 4px 8px;
        opacity: 0.7;
        white-space: nowrap;
      }
      .tooltip-measure {
        opacity: 1;
        font-weight: bold;
      }
      .tooltip-static {
        background-color: #ffcc33;
        color: black;
        border: 1px solid white;
      }
      .tooltip-measure:before,
      .tooltip-static:before {
        border-top: 6px solid rgba(0, 0, 0, 0.5);
        border-right: 6px solid transparent;
        border-left: 6px solid transparent;
        content: "";
        position: absolute;
        bottom: -6px;
        margin-left: -7px;
        left: 50%;
      }
      .tooltip-static:before {
        border-top-color: #ffcc33;
      }   
      .ol-geocoder.gcd-txt-container {
        position: fixed;
        width: 175px;
        height: 40px;
        top: 5px;
        right: 100px;
        box-sizing: border-box;
        border: 1px solid #101215;
        border-radius: 4px;
        z-index: 9999;
      }
      .ol-geocoder ul.gcd-txt-result {
        top: 45px;
      }
  /*sidenav herramientas*/

.moveSideButtonLayersOpened {
        position: fixed; top: 40%; left: 275px; font-size: 8px;z-index: 1;
        transition-timing-function: ease;  transition-duration: 0.25s;
        height: 90px;
        width: 45px;
        border-bottom-right-radius: 90px;
        border-top-right-radius: 90px;
        padding-right: 7.5px;
        cursor: pointer;
        color: ghostwhite;
        background-color: #417d97 !important;
      }
      .moveSideButtonLayersClosed {
        position: fixed; top: 40%; left: -5px; font-size: 8px;z-index: 1;
        transition-timing-function: ease; transition-duration: 0.25s;
        height: 90px;
        width: 45px;
        border-bottom-right-radius: 90px;
        border-top-right-radius: 90px;
        padding-right: 7.5px;
        cursor: pointer;
        color: ghostwhite;
        background-color: #384852 !important;
      }
      .moveSideButtonToolsOpened {
        position: fixed; top: 40%; right: 275px; font-size: 8px;z-index: 1;
        transition-timing-function: ease;  transition-duration: 0.25s;
        height: 90px;
        width: 45px;
        border-bottom-left-radius: 90px;
        border-top-left-radius: 90px;
        padding-left: 7.5px;
        cursor: pointer;
        color: ghostwhite;
        background-color: #417d97 !important;

      }
      .moveSideButtonToolsClosed {
        position: fixed; top: 40%; right: -5px; font-size: 8px;z-index: 1;
        transition-timing-function: ease; transition-duration: 0.25s;
        height: 90px;
        width: 45px;
        border-bottom-left-radius: 90px;
        border-top-left-radius: 90px;
        padding-left: 7.5px;
        cursor: pointer;
        color: ghostwhite;
        background-color: #417d97 !important;

      }

md-sidenav {
    box-sizing: border-box;
    position: absolute;
    -webkit-box-orient: vertical;
    -webkit-box-direction: normal;
    -webkit-flex-direction: column;
    flex-direction: column;
    z-index: 60;
    width: 275px;
    max-width: 275px;
    bottom: 0;
    overflow: auto;
    -webkit-overflow-scrolling: touch;
}

.md-button {
    display: inline-block;
    position: relative;
    cursor: pointer;
    min-height: 36px;
    min-width: 46.5px;
    line-height: 36px;
    padding-top: 10px;
}

md-checkbox.md-default-theme.md-checked .md-icon, md-checkbox.md-checked .md-icon{
  background-color: #c4dbdf;
}

.legend {
  margin-top:5px;margin-bottom:5px;margin-left:2.5px;margin-right:2.5px;
}

.textLogin{
        display: block;
        position: absolute;
        top: 1em;
        left: 50%;
        color: white;
        z-index: 9999;
        font: italic 14px Verdana;

      }

      .ol-custom-overviewmap,
      .ol-custom-overviewmap.ol-uncollapsible {
        top: auto;
        right: auto;
        left: 0;
        bottom: 0;
      }

      .ol-custom-overviewmap:not(.ol-collapsed)  {
        border: 1px solid black;
      }

      .ol-custom-overviewmap .ol-overviewmap-map {
        border: none;
        width: 250px;
      }

      .ol-custom-overviewmap .ol-overviewmap-box {
        border: 2px solid red;
      }

      .ol-custom-overviewmap:not(.ol-collapsed) button{
        bottom: auto;
        right: auto;
        left: 1px;
        bottom: 1px;
        display: none;
      }

      .fabSpeedDialdemoBasicUsage .text-capitalize {
  text-transform: capitalize; }

.fabSpeedDialdemoBasicUsage .md-fab:hover, .fabSpeedDialdemoBasicUsage .md-fab.md-focused {
  background-color: #000 !important; }

.fabSpeedDialdemoBasicUsage p.note {
  font-size: 1.2rem; }

.fabSpeedDialdemoBasicUsage .lock-size {
  min-width: 300px;
  min-height: 300px;
  width: 300px;
  height: 300px;
  margin-left: auto;
  margin-right: auto; }


/* BURGUER MANU */
@import url("https://fonts.googleapis.com/css?family=Advent+Pro:100, 200, 400");
* {
  padding: 0;
  margin: 0;
}

.container .menu-btn-1 {
  width: 3rem;
  height: 3rem;
  display: block;
  background-color: #384852;
  border-radius: 50%;
  position: relative;
  -webkit-box-shadow: 1px 1px 15px 0 rgba(0, 0, 0, 0.5);
  -moz-box-shadow: 1px 1px 15px 0 rgba(0, 0, 0, 0.5);
  box-shadow: 1px 1px 15px 0 rgba(0, 0, 0, 0.5);
}

.container .menu-btn-1 span, .container .menu-btn-1 span:after, .container .menu-btn-1 span:before {
  position: absolute;
  top: 50%;
  margin: -1px 0 0 -10px;
  left: 50%;
  width: 20px;
  height: 2px;
  background: #EAE9EC;
}

.container {
  display: flex;
  justify-content: center;
  align-items: center;
}
.container .menu-block {
  position: relative;
}
.container .menu-btn-1 {
  margin: 0 1rem;
  z-index: 1;
}
.container .menu-btn-1 span:after, .container .menu-btn-1 span:before {
  content: "";
  display: block;
  transition: 0.2s;
}
.container .menu-btn-1 span:after {
  transform: translateY(-5px);
}
.container .menu-btn-1 span:before {
  transform: translateY(5px);
}
.container .menu-btn-active-1 span {
  height: 0px;
}
.container .menu-btn-active-1 span:before {
  transform: rotate(-45deg);
}
.container .menu-btn-active-1 span:after {
  transform: rotate(45deg);
}
.container .menu a {
  position: realtive;
  display: inline-block;
  color: #EAE9EC;
  background-color: blue;
  height: 1.7rem;
  width: 1.7rem;
  border-radius: 50%;
  display: flex;
  justify-content: center;
  align-items: center;
  transition: 0.2s;
  position: absolute;
  left: calc(20% + 10px);
  top: calc(1rem - 5px);
  z-index: 0;
  background-color: #D73E3E;
  -webkit-box-shadow: 1px 1px 15px 0 rgba(0, 0, 0, 0.5);
  -moz-box-shadow: 1px 1px 15px 0 rgba(0, 0, 0, 0.5);
  box-shadow: 1px 1px 15px 0 rgba(0, 0, 0, 0.5);
}
.container .menu_active a:nth-of-type(1) {
  transform: translate(120%, 120%);
  transition: 0.4s;
}
.container .menu_active a:nth-of-type(2) {
  transform: translate(170%, 0%);
  transition: 0.4s;
}
.container .menu_active a:nth-of-type(3) {
  transform: translate(120%, -120%);
}

/* POPUP */
.ol-popup {
        position: absolute;
        background-color: white;
        -webkit-filter: drop-shadow(0 1px 4px rgba(0,0,0,0.2));
        filter: drop-shadow(0 1px 4px rgba(0,0,0,0.2));
        padding: 15px;
        border-radius: 10px;
        border: 1px solid #cccccc;
        bottom: 12px;
        left: -50px;
        min-width: 280px;
      }
      .ol-popup:after, .ol-popup:before {
        top: 100%;
        border: solid transparent;
        content: " ";
        height: 0;
        width: 0;
        position: absolute;
        pointer-events: none;
      }
      .ol-popup:after {
        border-top-color: white;
        border-width: 10px;
        left: 48px;
        margin-left: -10px;
      }
      .ol-popup:before {
        border-top-color: #cccccc;
        border-width: 11px;
        left: 48px;
        margin-left: -11px;
      }
      .ol-popup-closer {
        text-decoration: none;
        position: absolute;
        top: 2px;
        right: 8px;
      }
      .ol-popup-closer:after {
        content: "✖";
      }

  </style>
</head>

<body class="fixed-nav sticky-footer bg-dark sidenav-toggled" id="page-top" ng-app="signis" ng-controller="signisController as ctrl">
  <!-- Navigation-->
  
  <nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top" style="height: 50px !important;
   box-shadow: 0 10px 16px 0 rgba(0,0,0,0.2),0 6px 20px 0 rgba(0,0,0,0.19) !important;" id="mainNav">
    <img width=140 src="../static/img/signis.png">
        
      <ul class="navbar-nav ml-auto" style="margin-right: 70px;">
        <!--<li>Punto 1: <input type="text" id="idPoint1" /></li>-->
        <div id="coor" style="display: none;"></div>
        <div id="street" style="display: none;"></div>
        <div id="traficState" style="display: none;"></div>
        
        <!--<li>Punto 2: <input type="text" id="idPoint2" /></li>-->
        <li class="nav-item" style="height: 50px;position: fixed;padding-top: 6px;        
        margin-top: 0;margin-bottom: 0;padding-bottom: 0;        
        top: 0;text-align: center;left: 150px;width: 100px;">
          <a class="nav-link" href="/">
            <i class="fa fa-fw fa-home"></i>
            <span class="nav-link-text">Home</span>
          </a>
        </li> 
        <li class="nav-item" style="height: 50px;position: fixed;padding-top: 6px;        
        margin-top: 0;margin-bottom: 0;padding-bottom: 0;        
        top: 0;text-align: center;left: 250px;width: 100px;">
          <a class="nav-link" href="{% url 'viewer' %}">
            <i class="fa fa-fw fa-globe" style="color: #fff;"></i>
            <span class="nav-link-text" style="color: #fff;">Viewer</span>
          </a>
        </li>
        <div id="mensaje" class="alert alert-success" role="alert" style="position: fixed;padding-top: 10px;        
        margin-top: 5px;margin-bottom: 0;padding-bottom: 0;        
        top: 0;text-align:left; left: 425px; width: 500px; height: 40px;">
            <strong>Hi!</strong> Welcome to (S)IGNIS =)
          </div> 
        {% if user.get_username %}
            <li class="nav-item" style="height: 50px;position: fixed;padding-top: 5px;        
            margin-top: 0;margin-bottom: 0;padding-bottom: 0;  cursor: pointer;     
            top: 0;text-align: center;right: 0;width: 100px; ">
              <a class="nav-link" href="{% url 'logout' %}">
                <i class="fa fa-fw fa-sign-out"></i><span class="nav-link-text">{{ user.get_username }}</span></a>
            </li>     
        {% else %}
            <li class="nav-item" style="height: 50px;position: fixed;padding-top: 5px;        
            margin-top: 0;margin-bottom: 0;padding-bottom: 0;  cursor: pointer;     
            top: 0;text-align: center;right: 0;width: 100px; ">
              <a class="nav-link" href="{% url 'login' %}">
                <i class="fa fa-fw fa-sign-in"></i><span id="varLog" class="nav-link-text">Login</span></a>
            </li>
        {% endif %}
      </ul>
  </nav>
  <div class="row" style="position:absolute; width:100%; height:100%; right:2.2%; top:-45%;">
    <div id="formFirewalls" class="col-lg-12">
        <div class="tab-content">
             {% include 'templates/firewalls.html' %}
        </div>
    </div>
 </div>
  <div class="content-wrapper main container toolRoute">
    <div class="container-fluid">
        <div id="contenedor" style="height:calc(100% - 80px); width:100%; left:0px;top:50px;position:absolute;">
          <button id="idMoveSideButtonLayers" mat-mini-fab class="moveSideButtonLayersClosed" ng-click="openSidenavLayers(evt);">
            <i class="material-icons">layers</i>
          </button>
          
          <div id="olMap" style="height:100%;width:100%; left:0;top:0; position: absolute; background-color: black;">
            <div>
                            <select id="selectLayer1" class="form-control validate" ng-click="changeLayerSwipe1(evt);" style="z-index: 999999;width: 200px;position:absolute;display:none; top:5%; left: 30%;">
                               <option value="" disabled selected> Select one Model </option>
                               <option value="13">own model</option>
                               <option value="1">January</option>
                               <option value="2">February</option>
                               <option value="3">March</option>
                               <option value="4">April</option>
                               <option value="5">May</option>
                               <option value="6">June</option>
                               <option value="7">July</option>
                               <option value="8">August</option>
                               <option value="9">September</option>
                               <option value="10">October</option>
                               <option value="11">November</option>
                               <option value="12">December</option>
                           </select>
                           
                           <select id="selectLayer2" class="form-control validate" ng-click="changeLayerSwipe2(evt);" style="z-index: 999999;width: 200px;position:absolute;display:none; top:5%; right: 30%;">
                               <option value="" disabled selected> Select other Model </option>
                               <option value="13">own model</option>
                               <option value="1">January</option>
                               <option value="2">February</option>
                               <option value="3">March</option>
                               <option value="4">April</option>
                               <option value="5">May</option>
                               <option value="6">June</option>
                               <option value="7">July</option>
                               <option value="8">August</option>
                               <option value="9">September</option>
                               <option value="10">October</option>
                               <option value="11">November</option>
                               <option value="12">December</option>
                           </select>
            
            </div>
            <div id="legendLayer" style="position: fixed;display: block;top: 65px;right: 15px;z-index: 9;height: auto;width: auto; background-color: ghostwhite;
            border: 4px #384852 solid; padding: 5px;">
              <div id="headerLegendLayer" style="border-bottom: 1px black solid">Legend</div>
              <img id="imageLegendLayer" src="">
            </div>
            {% if user.get_username %}
            <div class="lock-size" layout="row" layout-align="center center" style="position: fixed !important; top: 120px; left: 5px; z-index: 9;">
              <div>
                <div class='menu-block'>
                  <a href='#' class='menu-btn-1'>
                    <span></span>
                  </a>
                  <nav class='menu'>
                    <a class="md-icon-button test-tooltip" aria-label="..." ng-click="map_drawFirewall()">
                      <i class="fa fa-fw fa-free-code-camp"></i>
                      <md-tooltip md-direction="right">Firewalls</md-tooltip>
                    </a>
                    <a class="md-icon-button test-tooltip" aria-label="..." ng-click="map_displays()">
                      <i class="fa fa-fw fa-columns"></i>
                      <md-tooltip md-direction="right">Compare Models</md-tooltip>
                    </a>
                    <a href="{% url 'model' %}" class="md-icon-button test-tooltip" aria-label="...">
                      <i class="fa fa-fw fa-file-image"></i>
                      <md-tooltip md-direction="right">Create Model</md-tooltip>
                    </a>
                  </nav>
                </div>
              </div>
              <!--<div class="options" >
                <ul><li>
                    <input id="ori" type="checkbox" ng-model="ctrl1" /><label for="ori"> horizontal swipe</label>
                </li><li>
                    <button type="button" onclick="ctrl1.set('position', 0.5);">Reset position</button>
                </li></ul>
              </div>!-->
            </div>
            {% endif %}
          </div>
          <md-sidenav class="md-sidenav-left" md-component-id="left" md-disable-backdrop="" md-whiteframe="4" styles="width: 350px;">
            <md-toolbar class="md-theme-indigo" style="background-color: #dc9e7c;">
              <h1 id="titleSidenavLayers" class="md-toolbar-tools">Layers</h1>
            </md-toolbar>
            <ul id="layerList" style="/*background-color:#1a3139 !important*/ padding: 25px; font-size:15px;">
              {% if user.get_username %}
              <ul>
                <h6>Vectorial Layers</h6>
                <div style="padding-left: 20px;">
                  <li id="LayerFirewalls" class="nav-item">
                      <md-checkbox ng-click="LoadLayerFirewalls()">
                        Firewalls
                      </md-checkbox>
                  </li>
                </div>
              </ul>
              {% endif %}
              <ul>
                <h6>Default Models</h6>
                <div style="padding-left: 20px;">
                  <li id="LayerDefaultModelJanuary" class="nav-item">
                    <md-checkbox ng-click="LoadLayerDefaultModelJanuary()">
                      January
                    </md-checkbox>
                  </li> 
                  <li id="LayerDefaultModelFebruary" class="nav-item">
                    <md-checkbox ng-click="LoadLayerDefaultModelFebruary()">
                      February
                    </md-checkbox>
                  </li> 
                  <li id="LayerDefaultModelMarch" class="nav-item">
                    <md-checkbox ng-click="LoadLayerDefaultModelMarch()">
                      March
                    </md-checkbox>
                  </li> 
                  <li id="LayerDefaultModelApril" class="nav-item">
                    <md-checkbox ng-click="LoadLayerDefaultModelApril()">
                      April
                    </md-checkbox>
                  </li> 
                  <li id="LayerDefaultModelMay" class="nav-item">
                    <md-checkbox ng-click="LoadLayerDefaultModelMay()">
                      May
                    </md-checkbox>
                  </li> 
                  <li id="LayerDefaultModelJuny" class="nav-item">
                    <md-checkbox ng-click="LoadLayerDefaultModelJuny()">
                      Juny
                    </md-checkbox>
                  </li> 
                  <li id="LayerDefaultModelJuly" class="nav-item">
                    <md-checkbox ng-click="LoadLayerDefaultModelJuly()">
                      July
                    </md-checkbox>
                  </li> 
                  <li id="LayerDefaultModelAugust" class="nav-item">
                    <md-checkbox ng-click="LoadLayerDefaultModelAugust()">
                      August
                    </md-checkbox>
                  </li> 
                  <li id="LayerDefaultModelSeptember" class="nav-item">
                    <md-checkbox ng-click="LoadLayerDefaultModelSeptember()">
                      September
                    </md-checkbox>
                  </li> 
                  <li id="LayerDefaultModelOctober" class="nav-item">
                    <md-checkbox ng-click="LoadLayerDefaultModelOctober()">
                      October
                    </md-checkbox>
                  </li> 
                  <li id="LayerDefaultModelNovember" class="nav-item">
                    <md-checkbox ng-click="LoadLayerDefaultModelNovember()">
                      November
                    </md-checkbox>
                  </li> 
                  <li id="LayerDefaultModelDecember" class="nav-item">
                    <md-checkbox ng-click="LoadLayerDefaultModelDecember()">
                      December
                    </md-checkbox>
                  </li> 
                </div>
              </ul> 
              <ul>Own Model</h6>
                  <li id="LayerOwnModel" class="nav-item"  style="padding-left: 20px;">
                    <md-checkbox ng-click="LoadLayerOwnModel()">
                      Model
                    </md-checkbox>
                  </li> 
              </ul>
              
              <ul>
                <h6>WMS Layers</h6>
                <div style="padding-left: 20px;">
             
                  <li id="LayerZonasActuacionUrgente" class="nav-item">
                      <md-checkbox ng-click="LoadLayerZonasActuacionUrgente()">
                        Areas of urgent action
                      </md-checkbox>
                  </li> 
                  <li id="LayerPlanesLocalesQuemas" class="nav-item">
                    <md-checkbox ng-click="LoadLayerPlanesLocalesQuemas()">
                        Local fire plans
                    </md-checkbox>
                </li> 
                <li id="LayerPlanesLocalesQuemas" class="nav-item">
                    <md-checkbox ng-click="LoadLayerFires46()">
                      Fires 2015
                    </md-checkbox>
                </li> 
                <li id="LayerPlanesLocalesQuemas" class="nav-item">
                    <md-checkbox ng-click="LoadLayerFires47()">
                      Fires 2014
                    </md-checkbox>
                </li> 
                <li id="LayerPlanesLocalesQuemas" class="nav-item">
                    <md-checkbox ng-click="LoadLayerFires48()">
                      Fires 2013
                    </md-checkbox>
                </li> 
                <li id="LayerPlanesLocalesQuemas" class="nav-item">
                    <md-checkbox ng-click="LoadLayerFires49()">
                      Fires 2012
                    </md-checkbox>
                </li> 
                <li id="LayerPlanesLocalesQuemas" class="nav-item">
                    <md-checkbox ng-click="LoadLayerFires50()">
                      Fires 2011
                    </md-checkbox>
                </li> 
                <li id="LayerPlanesLocalesQuemas" class="nav-item">
                    <md-checkbox ng-click="LoadLayerFires51()">
                      Fires 2010
                    </md-checkbox>
                </li> 
                <li id="LayerPlanesLocalesQuemas" class="nav-item">
                    <md-checkbox ng-click="LoadLayerFires52()">
                      Fires 2009
                    </md-checkbox>
                </li> 
                <li id="LayerPlanesLocalesQuemas" class="nav-item">
                    <md-checkbox ng-click="LoadLayerFires53()">
                      Fires 2008
                    </md-checkbox>
                </li> 
                <li id="LayerPlanesLocalesQuemas" class="nav-item">
                    <md-checkbox ng-click="LoadLayerFires54()">
                      Fires 2007
                    </md-checkbox>
                </li> 
                <li id="LayerPlanesLocalesQuemas" class="nav-item">
                    <md-checkbox ng-click="LoadLayerFires55()">
                      Fires 2006
                    </md-checkbox>
                </li> 
                <li id="LayerPlanesLocalesQuemas" class="nav-item">
                    <md-checkbox ng-click="LoadLayerFires56()">
                      Fires 2005
                    </md-checkbox>
                </li> 
                <li id="LayerPlanesLocalesQuemas" class="nav-item">
                    <md-checkbox ng-click="LoadLayerFires57()">
                      Fires 2004
                    </md-checkbox>
                </li> 
                <li id="LayerPlanesLocalesQuemas" class="nav-item">
                    <md-checkbox ng-click="LoadLayerFires58()">
                      Fires 2003
                    </md-checkbox>
                </li> 
                <li id="LayerPlanesLocalesQuemas" class="nav-item">
                    <md-checkbox ng-click="LoadLayerFires59()">
                      Fires 2002
                    </md-checkbox>
                </li> 
                <li id="LayerPlanesLocalesQuemas" class="nav-item">
                    <md-checkbox ng-click="LoadLayerFires60()">
                      Fires 2001
                    </md-checkbox>
                </li> 
                <li id="LayerPlanesLocalesQuemas" class="nav-item">
                    <md-checkbox ng-click="LoadLayerFires61()">
                      Fires 2000
                    </md-checkbox>
                </li> 
                <li id="LayerPlanesLocalesQuemas" class="nav-item">
                    <md-checkbox ng-click="LoadLayerFires62()">
                      Fires 1999
                    </md-checkbox>
                </li> 
                <li id="LayerPlanesLocalesQuemas" class="nav-item">
                    <md-checkbox ng-click="LoadLayerFires63()">
                      Fires 1998
                    </md-checkbox>
                </li> 
                <li id="LayerPlanesLocalesQuemas" class="nav-item">
                    <md-checkbox ng-click="LoadLayerFires64()">
                      Fires 1997
                    </md-checkbox>
                </li> 
                <li id="LayerPlanesLocalesQuemas" class="nav-item">
                    <md-checkbox ng-click="LoadLayerFires65()">
                      Fires 1996
                    </md-checkbox>
                </li> 
                <li id="LayerPlanesLocalesQuemas" class="nav-item">
                    <md-checkbox ng-click="LoadLayerFires66()">
                      Fires 1995
                    </md-checkbox>
                </li> 
                <li id="LayerPlanesLocalesQuemas" class="nav-item">
                    <md-checkbox ng-click="LoadLayerFires67()">
                      Fires 1994
                    </md-checkbox>
                </li> 
                <li id="LayerPlanesLocalesQuemas" class="nav-item">
                    <md-checkbox ng-click="LoadLayerFires68()">
                      Fires 1993
                    </md-checkbox>
                </li>
              </div>
              </ul>
            </ul> 
          </md-sidenav>
          <div id="overviewMap" style="height:200px;width:250px; left:1em;bottom:1em; position: absolute; background-color: black; border: black 2px solid;"></div>
        </div>
    </div>
  </div>
  <div id="containerCanvas" style="max-width: 500px; max-height: 300px; position: fixed; z-index: -10;"></div>
    <footer class="sticky-footer">
      <div class="container" style="margin-left: 0px !important;justify-content: left;">                               
        <div class="text-center" style="display: flex; flex-direction: row;">
          <div style="position: relative; margin-right: 15px;">Geographic Coordinates WGS84</div>	
          <div id="mouse-position2" style="position: relative;margin-right: 15px;">	</div>	
          <div style="position: relative;margin-right: 15px; ">UTM </div>
          <div id="mouse-position3" style="position: relative;margin-right: 15px;"> </div>
        </div>
      </div>
    </footer>
    <!-- Scroll to Top Button-->
    <a class="scroll-to-top rounded" href="#page-top">
      <i class="fa fa-angle-up"></i>
    </a>
    <div id="popup" class="ol-popup">
      <a href="#" id="popup-closer" class="ol-popup-closer"></a>
      <div id="popup-content"></div>
    </div>
    <!-- Logout Modal-->
    <!-- Bootstrap core JavaScript-->
    <script src="../static/vendor/jquery/jquery.min.js"></script>
    <script src="../static/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
    <!-- Core plugin JavaScript-->
    <script src="../static/vendor/jquery-easing/jquery.easing.min.js"></script>
    <!-- Page level plugin JavaScript-->
    <script src="../static/vendor/chart.js/Chart.min.js"></script>
    <!-- Custom scripts for all pages-->
    <script src="../static/js/sb-admin.min.js"></script>

    <script src="../static/js/request.js"></script>
    <script src="../static/js/main.js"></script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ol3/4.0.1/ol.js"></script>
    <script type="text/javascript" src="https://cdn.rawgit.com/Viglino/ol-ext/master/dist/ol-ext.min.js"></script>
    <!-- jsPanel JavaScript -->
  <script src="https://cdn.jsdelivr.net/npm/jspanel4@4.0.0/dist/jspanel.js"></script>
  <!-- optionally jsPanel extensions -->
  <script src="https://cdn.jsdelivr.net/npm/jspanel4@4.0.0/dist/extensions/modal/jspanel.modal.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jspanel4@4.0.0/dist/extensions/tooltip/jspanel.tooltip.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jspanel4@4.0.0/dist/extensions/hint/jspanel.hint.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jspanel4@4.0.0/dist/extensions/layout/jspanel.layout.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jspanel4@4.0.0/dist/extensions/contextmenu/jspanel.contextmenu.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jspanel4@4.0.0/dist/extensions/dock/jspanel.dock.js"></script>

  <script src="https://cdn.jsdelivr.net/npm/ol-contextmenu"></script>

  <script src="https://unpkg.com/ol-popup@3.0.0"></script>
  <script src="../static/js/ol-geocoder.js"></script>
  <script src="../static/js/featureanimation.js"></script>
  <script src="../static/js/zoomanimation.js"></script>
  
  <script type="text/javascript" src="https://cdn.rawgit.com/Viglino/ol-ext/master/dist/ol-ext.min.js"></script>
  <script type="text/javascript" src="../static/dist/ol-ext.js"></script>
  <script>
  $('.menu-btn-1').on('click', function(e){
  e.preventDefault();
  $(this).toggleClass('menu-btn-active-1');
  $('.menu').toggleClass('menu_active');
});
</script>
  <script type="text/javascript">
  
  //	ANGULAR	    
  var sesion = angular.module('signis', ['ngMaterial', 'ngMessages']); 
  sesion.controller('signisController',['$scope','$http','$mdSidenav','$mdToast', function ($scope, $http, $mdSidenav, $mdToast) {

/* POPUP */
/**
       * Elements that make up the popup.
       */
       var container = document.getElementById('popup');
      var content = document.getElementById('popup-content');
      var closer = document.getElementById('popup-closer');


      /**
       * Create an overlay to anchor the popup to the map.
       */
      var overlay = new ol.Overlay(/** @type {olx.OverlayOptions} */ ({
        element: container,
        autoPan: true,
        autoPanAnimation: {
          duration: 250
        }
      }));


      /**
       * Add a click handler to hide the popup.
       * @return {boolean} Don't follow the href.
       */
      closer.onclick = function() {
        overlay.setPosition(undefined);
        closer.blur();
        return false;
      };

/* POPUP */
    this.topDirections = ['left', 'up'];
      this.bottomDirections = ['down', 'right'];

      this.isOpen = false;
      var capas_wms = [];
      var capas_geoserver = [];
      this.availableModes = ['md-fling', 'md-scale'];
      this.selectedMode = 'md-fling';

      this.availableDirections = ['up', 'down', 'left', 'right'];
      this.selectedDirection = 'up';
      var moveSideButtonLayers = false;
      $scope.openSidenavLayers = function(evt) {
        $mdSidenav('left').toggle();

    if (moveSideButtonLayers === false) {
      moveSideButtonLayers = true;
      document.getElementById('idMoveSideButtonLayers').classList.remove('moveSideButtonLayersClosed');
      document.getElementById('idMoveSideButtonLayers').classList.add('moveSideButtonLayersOpened');
    } else {
      moveSideButtonLayers = false;
      document.getElementById('idMoveSideButtonLayers').classList.remove('moveSideButtonLayersOpened');
      document.getElementById('idMoveSideButtonLayers').classList.add('moveSideButtonLayersClosed');
    }
  }
    var currentdate = new Date();
    var datetime = "2018-" + currentdate.getMonth() + "-" + currentdate.getDate();
    
    window.app = {};
    var app = window.app;
		//CENTRAR//
		  app.centrar = function(opt_options) {
		  var options = opt_options || {};
		  var button = document.createElement('button');
		 /*  button.innerHTML = 'B'; */
		   button.className = 'centrar';
		  var this_ = this;
		  var centrar = function() {
			var center = [-77934.38, 4831972.59];
      olMap.getView().setCenter(center);
			olMap.getView().setZoom(8.25);
		  };
		  button.addEventListener('click', centrar, false);
		  button.addEventListener('touchstart', centrar, false);
		  var element = document.createElement('div');
		  element.className = 'centrar ol-unselectable ol-control';
		  element.appendChild(button);  
		  ol.control.Control.call(this, {element: element,target: options.target });
		};
		ol.inherits(app.centrar, ol.control.Control);
    
		var mousePositionControl2 = new ol.control.MousePosition({
		  coordinateFormat: ol.coordinate.createStringXY(6),
		  projection: 'EPSG:4326',
		  className: 'custom-mouse-position',
		  coordinateFormat: ol.coordinate.toStringHDMS,
		  target: document.getElementById('mouse-position2'),
		  undefinedHTML: ''
		});
	   var mousePositionControl3 = new ol.control.MousePosition({
			  target: document.getElementById('mouse-position3'),
			  className: 'custom-mouse-position',
			  undefinedHTML: '',
			  projection: myProjection,
			  coordinateFormat : ol.coordinate.createStringXY(2),
		  });

  var source_capabase = new ol.source.XYZ({  url: 'https://{1-4}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}.png'});
	var capabase = new ol.layer.Tile({source: source_capabase,name: 'DARK',description: 'CARTO',visible: true,
  baseLayer: true, displayInLayerSwitcher: true,});
  var OSM = new ol.layer.Tile({ source: new ol.source.OSM(), visible:true, 
    baseLayer: true, displayInLayerSwitcher: true,  });
  var source_aerial_bing = new ol.source.BingMaps({
            key: 'ArI8uCPDtw0y4e58IBL66Qc-RmfMG3DvBCNS9Kdzj4BUS9SW6xNlRz9FRmW9NzKZ',
            imagerySet: 'AerialWithLabels'
          });
		var aerial = new ol.layer.Tile({name:'aerial_bing',title: 'aerial_bing', 
    baseLayer: true, displayInLayerSwitcher: true, 
    preload: Infinity, description: 'Aerial',visible: true, source: source_aerial_bing});

  var myProjectionName = 'EPSG:3857'; 
  // proj4.defs(myProjectionName, "+proj=utm +zone=30 +ellps=GRS80 +units=m +no_defs");
	var myProjection = ol.proj.get(myProjectionName);

	// --- Se define el MAPA ---
  var overviewMap = new ol.Map({
    interactions: ol.interaction.defaults().extend([new ol.interaction.DragRotateAndZoom()]),
    layers: [OSM],
    controls: [mousePositionControl2,mousePositionControl3],
    view: new ol.View({
      projection: myProjection,
      center: [-77934.38, 4831972.59],
      zoom: 3
    }),
  target: document.getElementById('overviewMap'),
  });
 

  var source = new ol.source.Vector({wrapX: false});

    var vector = new ol.layer.Vector({
        source: source
    }); 
    
  var olMap = new ol.Map({
    interactions: ol.interaction.defaults().extend([new ol.interaction.DragRotateAndZoom()]),
    layers: [OSM, vector],
    overlays: [overlay],
    view: new ol.View({
        projection: myProjection,
        center: [-77934.38, 4831972.59],
        zoom: 8.25
    }),
    controls: ol.control.defaults().extend ([
      new ol.control.ScaleLine(),            
      mousePositionControl2,mousePositionControl3,
      new ol.control.FullScreen(),
      new app.centrar(),
    ]),
    target: document.getElementById('olMap'),
    });
    // var ctrl = new ol.control.CanvasScaleLine({	});
    // olMap.addControl(ctrl);
    // olMap.addControl(new ol.control.LayerSwitcherImage());
      // Change VIEW
    
      var view = olMap.getView();
      view.on("change:center", function(e) {
          overviewMap.getView().setCenter(olMap.getView().getCenter());
      });
      view.on("change:resolution", function(e) {
          overviewMap.getView().setZoom(olMap.getView().getZoom() - 4);
      });
      olMap.on('click', function(evt) {
        res = olMap.getView().getResolution();
        identificar(evt);
      }); 
      var vectorSource = new ol.source.Vector();
      var vectorLayer = new ol.layer.Vector({
        source: vectorSource,
        style: new ol.style.Style({
          stroke: new ol.style.Stroke({
            color: 'blue',
            width: 0.5
          }),
          fill: new ol.style.Fill({
            color: 'rgba(0, 0, 255, 0.05)'
          })
        }),
        crossOrigin: 'Anonymous',
        baseLayer: false, displayInLayerSwitcher: false,
      });
      olMap.addLayer(vectorLayer);

      /* LAYERS */
      // Aparcamiento bicis:
  // http://mapas.valencia.es/lanzadera/opendata/aparcabicis/wms?
  
  var lib_openLayersLabelUtilities_createTextStyleFunction = function() {
      return function(feature, color) {
          var estilo=new ol.style.Style({
                stroke: new ol.style.Stroke({
                      color: '#b84b00',
                      width: 4
                    }),
          });
        return [estilo];
      }
    };
  
  var sourceFirewalls = new ol.source.Vector({
            format: new ol.format.GeoJSON(),
            url: function(extent) {
                return 'http://localhost:8080/geoserver/wfs/' + '?service=WFS&' +
                'version=1.1.0&request=GetFeature&typename=' + 'signis_osgis:firewalls_firewalls' + '&' +
                'outputFormat=application/json&' +
                'srsname=EPSG:' + '3857' + '&bbox=' + extent.join(',') + '&/';
            },
            strategy: ol.loadingstrategy.bbox
        });

    var Firewalls = new ol.layer.Vector({
        source: sourceFirewalls,
        title: 'Firewalls', description: 'Firewalls from CCVV', visible: false, crossOrigin: 'anonymous', serverType: 'geoserver',
        baseLayer: false, displayInLayerSwitcher: false,
        style: lib_openLayersLabelUtilities_createTextStyleFunction()
    });
    
   /* var Firewalls = new ol.layer.Tile({
    source: new ol.source.TileWMS({
      url: 'http://localhost:8080/geoserver/signis_osgis/wms',
      params: {
        'LAYERS': 'signis_osgis:firewalls_firewalls', 'VERSION': '1.3.0', 'CRS': 'EPSG:3857'
      },
    }), title: 'Firewalls', description: 'Firewalls from CCVV', visible: false, crossOrigin: 'anonymous', serverType: 'mapserver',
    baseLayer: false, displayInLayerSwitcher: false
  });*/
  
  Firewalls.setZIndex(999);
  olMap.addLayer(Firewalls);
  // capas_wms.push(Firewalls);
  var collection = new ol.Collection();
  var select = new ol.interaction.Select({
    features: collection
  });
  olMap.addInteraction(select);
  select.on('select', function(evt) {
    if (evt.selected[0]) {
      var description = evt.selected[0].I.descript;
      var coordinate = evt.mapBrowserEvent.coordinate;
      content.innerHTML = '<p>' + description + '</p>';
      overlay.setPosition(coordinate);
    }
  });
  $scope.LoadLayerFirewalls = function() { 
          if (Firewalls.getVisible()==false) {
              Firewalls.setVisible(true);     
              var imgLegend = 'http://localhost:8080/geoserver/signis_osgis/wms?service=wms&VERSION=1.0.0&request=GetLegendGraphic&FORMAT=image/png&LEGEND_OPTIONS=forceLabels:on&LAYER=signis_osgis:firewalls_firewalls';
              document.getElementById('imageLegendLayer').src = imgLegend;        
              }              
          else {
              Firewalls.setVisible(false);
              document.getElementById('imageLegendLayer').src = '';
              }
        };
        
    function lib_openLayersUtilities_getLayersList(mapa) {
        //devuelve todas las capas del mapa
        var allLayers = [];
        var mapLayers = mapa.getLayers().getArray();
        
        mapLayers.forEach(function (layer, i) {
            if (layer instanceof ol.layer.Group) {
                layer.getLayers().getArray().forEach(function(sublayer, j, layers) {
                    allLayers.push(sublayer);
                })
            } else if ( !(layer instanceof ol.layer.Group)) {
                    allLayers.push(layer);
            }
        });
        return allLayers;
    }

    function lib_openLayersUtilities_getLayerObjectByTitle(mapa,titulo_capa){
        //Devuelve el objeto capa que coincide con el título de la capa
        var capas = lib_openLayersUtilities_getLayersList(mapa);
        for (var i = 0, len = capas.length; i < len; i++) {
              var capa=capas[i];
              if (capa.I.title==titulo_capa){
                  return capa;
              }
        }
    }
    
    // DRAW FIREWALLS ------------------------------------------------------------------------------
    var dF = 0;   
    $scope.map_drawFirewall = function() {
        if (dF == 0) {
            var WFS_Firewalls = lib_openLayersUtilities_getLayerObjectByTitle(olMap,'Firewalls');
            var firewallsSource = WFS_Firewalls.getSource();     
            draw_lineString = new ol.interaction.Draw({
                source: firewallsSource,
                type: ('LineString'),
                geometryFunction: function(coords, geom) {
                    if (!geom) {
                        geom = new ol.geom.LineString(null);
                    }
                    geom.setCoordinates(coords);
                    var coord = coords.toString();
                    document.getElementById("geom").value = coord;
                    return geom;
                }
              });
            olMap.addInteraction(draw_lineString);
            document.getElementById("insertForm").style.display = "block";
            dF = 1;
        }else if (dF == 1){
            olMap.removeInteraction(draw_lineString);
            document.getElementById("insertForm").style.display = "none";
            dF = 0;
        }
    };
    
    
    
  var imgLegend = 'http://carto.icv.gva.es/arcgis/services/tm_medio_ambiente/prevencion_de_incendios/MapServer/WmsServer?service=wms&VERSION=1.0.0&request=GetLegendGraphic&FORMAT=image/png&LEGEND_OPTIONS=forceLabels:on&LAYER=';

  var ZonasActuacionUrgente = new ol.layer.Tile({
    source: new ol.source.TileWMS({
      url: 'http://carto.icv.gva.es/arcgis/services/tm_medio_ambiente/prevencion_de_incendios/MapServer/WMSServer',
      params: {
        'LAYERS': '0', 'STYLES': 'default', 'VERSION': '1.3.0', 'CRS': 'EPSG:3857'
      },
    }), title: 'ZonasActuacionUrgente', description: 'OpenDataValencia', visible: false, crossOrigin: 'anonymous', serverType: 'mapserver',
    baseLayer: false, displayInLayerSwitcher: false
  });
  ZonasActuacionUrgente.setZIndex(999);
  olMap.addLayer(ZonasActuacionUrgente);
  capas_wms.push(ZonasActuacionUrgente);
  /* Conf to model */
  var arrayModel = [];
  
  var LayerDefaultModelJanuary =  new ol.layer.Tile({
    source: new ol.source.TileWMS({
      url: 'http://localhost:8080/geoserver/signis_osgis/wms',
      params: {
        'LAYERS': 'risk1', 'VERSION': '1.3.0', 'CRS': 'EPSG:3857'
      },
    }), title: 'default_model_january', description: 'default_model_january', visible: false, crossOrigin: 'anonymous', serverType: 'geoserver',
    baseLayer: false, displayInLayerSwitcher: false
  });
  olMap.addLayer(LayerDefaultModelJanuary);
  capas_wms.push(LayerDefaultModelJanuary);
  arrayModel.push(LayerDefaultModelJanuary);
  $scope.LoadLayerDefaultModelJanuary = function() {
    if (LayerDefaultModelJanuary.getVisible()==false) {
      LayerDefaultModelJanuary.setVisible(true); 
        }              
    else {
      LayerDefaultModelJanuary.setVisible(false);
        }
  };
  var LayerDefaultModelFebruary =  new ol.layer.Tile({
    source: new ol.source.TileWMS({
      url: 'http://localhost:8080/geoserver/signis_osgis/wms',
      params: {
        'LAYERS': 'risk2', 'VERSION': '1.3.0', 'CRS': 'EPSG:3857'
      },
    }), title: 'default_model_february', description: 'default_model_february', visible: false, crossOrigin: 'anonymous', serverType: 'geoserver',
    baseLayer: false, displayInLayerSwitcher: false
  });
  olMap.addLayer(LayerDefaultModelFebruary);
  capas_wms.push(LayerDefaultModelFebruary);
    arrayModel.push(LayerDefaultModelFebruary);
  $scope.LoadLayerDefaultModelFebruary = function() {
    if (LayerDefaultModelFebruary.getVisible()==false) {
      LayerDefaultModelFebruary.setVisible(true); 
        }              
    else {
      LayerDefaultModelFebruary.setVisible(false);
        }
  };
  var LayerDefaultModelMarch =  new ol.layer.Tile({
    source: new ol.source.TileWMS({
      url: 'http://localhost:8080/geoserver/signis_osgis/wms',
      params: {
        'LAYERS': 'risk3', 'VERSION': '1.3.0', 'CRS': 'EPSG:3857'
      },
    }), title: 'default_model_march', description: 'default_model_march', visible: false, crossOrigin: 'anonymous', serverType: 'geoserver',
    baseLayer: false, displayInLayerSwitcher: false
  });
  olMap.addLayer(LayerDefaultModelMarch);
  capas_wms.push(LayerDefaultModelMarch);
      arrayModel.push(LayerDefaultModelMarch);
  $scope.LoadLayerDefaultModelMarch = function() {
    if (LayerDefaultModelMarch.getVisible()==false) {
      LayerDefaultModelMarch.setVisible(true); 
        }              
    else {
      LayerDefaultModelMarch.setVisible(false);
        }
  };
  var LayerDefaultModelApril =  new ol.layer.Tile({
    source: new ol.source.TileWMS({
      url: 'http://localhost:8080/geoserver/signis_osgis/wms',
      params: {
        'LAYERS': 'risk4', 'VERSION': '1.3.0', 'CRS': 'EPSG:3857'
      },
    }), title: 'default_model_april', description: 'default_model_april', visible: false, crossOrigin: 'anonymous', serverType: 'geoserver',
    baseLayer: false, displayInLayerSwitcher: false
  });
  olMap.addLayer(LayerDefaultModelApril);
  capas_wms.push(LayerDefaultModelApril);
        arrayModel.push(LayerDefaultModelApril);
  $scope.LoadLayerDefaultModelApril = function() {
    if (LayerDefaultModelApril.getVisible()==false) {
      LayerDefaultModelApril.setVisible(true); 
        }              
    else {
      LayerDefaultModelApril.setVisible(false);
        }
  };
  var LayerDefaultModelMay =  new ol.layer.Tile({
    source: new ol.source.TileWMS({
      url: 'http://localhost:8080/geoserver/signis_osgis/wms',
      params: {
        'LAYERS': 'risk5', 'VERSION': '1.3.0', 'CRS': 'EPSG:3857'
      },
    }), title: 'default_model_may', description: 'default_model_may', visible: false, crossOrigin: 'anonymous', serverType: 'geoserver',
    baseLayer: false, displayInLayerSwitcher: false
  });
  olMap.addLayer(LayerDefaultModelMay);
  capas_wms.push(LayerDefaultModelMay);
        arrayModel.push(LayerDefaultModelMay);
  $scope.LoadLayerDefaultModelMay = function() {
    if (LayerDefaultModelMay.getVisible()==false) {
      LayerDefaultModelMay.setVisible(true); 
        }              
    else {
      LayerDefaultModelMay.setVisible(false);
        }
  };
  var LayerDefaultModelJuny =  new ol.layer.Tile({
    source: new ol.source.TileWMS({
      url: 'http://localhost:8080/geoserver/signis_osgis/wms',
      params: {
        'LAYERS': 'risk6', 'VERSION': '1.3.0', 'CRS': 'EPSG:3857'
      },
    }), title: 'default_model_juny', description: 'default_model_juny', visible: false, crossOrigin: 'anonymous', serverType: 'geoserver',
    baseLayer: false, displayInLayerSwitcher: false
  });
  olMap.addLayer(LayerDefaultModelJuny);
  capas_wms.push(LayerDefaultModelJuny);
        arrayModel.push(LayerDefaultModelJuny);
  $scope.LoadLayerDefaultModelJuny = function() {
    if (LayerDefaultModelJuny.getVisible()==false) {
      LayerDefaultModelJuny.setVisible(true); 
        }              
    else {
      LayerDefaultModelJuny.setVisible(false);
        }
  };
  var LayerDefaultModelJuly =  new ol.layer.Tile({
    source: new ol.source.TileWMS({
      url: 'http://localhost:8080/geoserver/signis_osgis/wms',
      params: {
        'LAYERS': 'risk7', 'VERSION': '1.3.0', 'CRS': 'EPSG:3857'
      },
    }), title: 'default_model_july', description: 'default_model_july', visible: false, crossOrigin: 'anonymous', serverType: 'geoserver',
    baseLayer: false, displayInLayerSwitcher: false
  });
  olMap.addLayer(LayerDefaultModelJuly);
  capas_wms.push(LayerDefaultModelJuly);
          arrayModel.push(LayerDefaultModelJuly);
  $scope.LoadLayerDefaultModelJuly = function() {
    if (LayerDefaultModelJuly.getVisible()==false) {
      LayerDefaultModelJuly.setVisible(true); 
        }              
    else {
      LayerDefaultModelJuly.setVisible(false);
        }
  };
  var LayerDefaultModelAugust =  new ol.layer.Tile({
    source: new ol.source.TileWMS({
      url: 'http://localhost:8080/geoserver/signis_osgis/wms',
      params: {
        'LAYERS': 'risk8', 'VERSION': '1.3.0', 'CRS': 'EPSG:3857'
      },
    }), title: 'default_model_august', description: 'default_model_august', visible: false, crossOrigin: 'anonymous', serverType: 'geoserver',
    baseLayer: false, displayInLayerSwitcher: false
  });
  olMap.addLayer(LayerDefaultModelAugust);
  capas_wms.push(LayerDefaultModelAugust);
            arrayModel.push(LayerDefaultModelAugust);
  $scope.LoadLayerDefaultModelAugust = function() {
    if (LayerDefaultModelAugust.getVisible()==false) {
      LayerDefaultModelAugust.setVisible(true); 
        }              
    else {
      LayerDefaultModelAugust.setVisible(false);
        }
  };
  var LayerDefaultModelSeptember =  new ol.layer.Tile({
    source: new ol.source.TileWMS({
      url: 'http://localhost:8080/geoserver/signis_osgis/wms',
      params: {
        'LAYERS': 'risk9', 'VERSION': '1.3.0', 'CRS': 'EPSG:3857'
      },
    }), title: 'default_model_september', description: 'default_model_september', visible: false, crossOrigin: 'anonymous', serverType: 'geoserver',
    baseLayer: false, displayInLayerSwitcher: false
  });
  olMap.addLayer(LayerDefaultModelSeptember);
  capas_wms.push(LayerDefaultModelSeptember);
  arrayModel.push(LayerDefaultModelSeptember);
  $scope.LoadLayerDefaultModelSeptember = function() {
    if (LayerDefaultModelSeptember.getVisible()==false) {
      LayerDefaultModelSeptember.setVisible(true); 
        }              
    else {
      LayerDefaultModelSeptember.setVisible(false);
        }
  };
  var LayerDefaultModelOctober =  new ol.layer.Tile({
    source: new ol.source.TileWMS({
      url: 'http://localhost:8080/geoserver/signis_osgis/wms',
      params: {
        'LAYERS': 'risk10', 'VERSION': '1.3.0', 'CRS': 'EPSG:3857'
      },
    }), title: 'default_model_october', description: 'default_model_october', visible: false, crossOrigin: 'anonymous', serverType: 'geoserver',
    baseLayer: false, displayInLayerSwitcher: false
  });
  olMap.addLayer(LayerDefaultModelOctober);
  capas_wms.push(LayerDefaultModelOctober);
  arrayModel.push(LayerDefaultModelOctober);
  $scope.LoadLayerDefaultModelOctober = function() {
    if (LayerDefaultModelOctober.getVisible()==false) {
      LayerDefaultModelOctober.setVisible(true); 
        }              
    else {
      LayerDefaultModelOctober.setVisible(false);
        }
  };
  var LayerDefaultModelNovember =  new ol.layer.Tile({
    source: new ol.source.TileWMS({
      url: 'http://localhost:8080/geoserver/signis_osgis/wms',
      params: {
        'LAYERS': 'risk11', 'VERSION': '1.3.0', 'CRS': 'EPSG:3857'
      },
    }), title: 'default_model_november', description: 'default_model_november', visible: false, crossOrigin: 'anonymous', serverType: 'geoserver',
    baseLayer: false, displayInLayerSwitcher: false
  });
  olMap.addLayer(LayerDefaultModelNovember);
  capas_wms.push(LayerDefaultModelNovember);
  arrayModel.push(LayerDefaultModelNovember);
  $scope.LoadLayerDefaultModelNovember = function() {
    if (LayerDefaultModelNovember.getVisible()==false) {
      LayerDefaultModelNovember.setVisible(true); 
        }              
    else {
      LayerDefaultModelNovember.setVisible(false);
        }
  };
  var LayerDefaultModelDecember =  new ol.layer.Tile({
    source: new ol.source.TileWMS({
      url: 'http://localhost:8080/geoserver/signis_osgis/wms',
      params: {
        'LAYERS': 'risk12', 'VERSION': '1.3.0', 'CRS': 'EPSG:3857'
      },
    }), title: 'default_model_december', description: 'default_model_december', visible: false, crossOrigin: 'anonymous', serverType: 'geoserver',
    baseLayer: false, displayInLayerSwitcher: false
  });
  olMap.addLayer(LayerDefaultModelDecember);
  capas_wms.push(LayerDefaultModelDecember);
  arrayModel.push(LayerDefaultModelDecember);
  $scope.LoadLayerDefaultModelDecember = function() {
    if (LayerDefaultModelDecember.getVisible()==false) {
      LayerDefaultModelDecember.setVisible(true); 
        }              
    else {
      LayerDefaultModelDecember.setVisible(false);
        }
  };
  var LayerOwnModel =  new ol.layer.Tile({
    source: new ol.source.TileWMS({
      url: 'http://localhost:8080/geoserver/signis_osgis/wms',
      params: {
        'LAYERS': 'risk_user', 'VERSION': '1.3.0', 'CRS': 'EPSG:3857'
      },
    }), title: 'own_model', description: 'own_model', visible: false, crossOrigin: 'anonymous', serverType: 'geoserver',
    baseLayer: false, displayInLayerSwitcher: false
  });
  olMap.addLayer(LayerOwnModel);
  capas_wms.push(LayerOwnModel);
  arrayModel.push(LayerOwnModel);
  $scope.LoadLayerOwnModel = function() {
    if (LayerOwnModel.getVisible()==false) {
      LayerOwnModel.setVisible(true); 
        }              
    else {
      LayerOwnModel.setVisible(false);
        }
  };
    /* Conf to model */
  $scope.LoadLayerZonasActuacionUrgente = function() { 
          if (ZonasActuacionUrgente.getVisible()==false) {
              ZonasActuacionUrgente.setVisible(true);  
              document.getElementById('imageLegendLayer').src = imgLegend + '0';
              }              
          else {
              ZonasActuacionUrgente.setVisible(false);
              document.getElementById('imageLegendLayer').src = '';
              }
        };
  var PlanesLocalesQuemas = new ol.layer.Tile({
    source: new ol.source.TileWMS({
      url: 'http://carto.icv.gva.es/arcgis/services/tm_medio_ambiente/prevencion_de_incendios/MapServer/WMSServer',
      params: {
        'LAYERS': '1', 'STYLES': 'default', 'VERSION': '1.3.0', 'CRS': 'EPSG:3857'
      },
    }), title: 'PlanesLocalesQuemas', description: 'OpenDataValencia', visible: false, crossOrigin: 'anonymous', serverType: 'mapserver',
    baseLayer: false, displayInLayerSwitcher: false
  });
  PlanesLocalesQuemas.setZIndex(999);
  olMap.addLayer(PlanesLocalesQuemas);
  capas_wms.push(PlanesLocalesQuemas);
  $scope.LoadLayerPlanesLocalesQuemas = function() { 
    if (PlanesLocalesQuemas.getVisible()==false) { 
      PlanesLocalesQuemas.setVisible(true);  
      document.getElementById('imageLegendLayer').src = imgLegend + '1';
      }              
    else { PlanesLocalesQuemas.setVisible(false); 
      document.getElementById('imageLegendLayer').src = '';}
  };
  // DISPLAYS -----------------------------------------------------------------------------------
    var ctrl1 = new ol.control.Swipe();
    var dC = 0;
    $scope.map_displays = function() {
        if (dC == 0) {
            // Control
            olMap.addControl(ctrl1);
            // Set stamen on left
            ctrl1.addLayer(PlanesLocalesQuemas);
            // OSM on right
            ctrl1.addLayer(ZonasActuacionUrgente, true);
            dC = 1;
            document.getElementById('selectLayer1').style.display = 'block';
            document.getElementById('selectLayer2').style.display = 'block';
        }else if (dC == 1){
            olMap.removeControl(ctrl1);
            dC = 0;
            document.getElementById('selectLayer1').style.display = 'none';
            document.getElementById('selectLayer2').style.display = 'none';
        }
    };  
    $scope.changeLayerSwipe1 = function(evt) {

        var e = document.getElementById('selectLayer1');
        var selectLayer1 = e.options[e.selectedIndex].value;
        if (selectLayer1 != ''){
            console.log(selectLayer1);
            ctrl1.addLayer(arrayModel[selectLayer1]);
         }
    };
    
    $scope.changeLayerSwipe2 = function() {
    
    };
     

        // Capas de incendios forestales
        var i = 46;
        var j = 69;
        var idName = []
        for (i; i<j; i++) {
          idName.push(i);
        
          var fire = new ol.layer.Tile({
            source: new ol.source.TileWMS({
              url: 'http://carto.icv.gva.es/arcgis/services/tm_medio_ambiente/prevencion_de_incendios/MapServer/WMSServer',
              params: {
                'LAYERS': i, 'STYLES': 'default', 'VERSION': '1.3.0', 'CRS': 'EPSG:3857'
              },
            }), name: 'fire' + i, title: 'fire' + i, description: 'OpenDataValencia', visible: false, crossOrigin: 'anonymous', serverType: 'mapserver',
            baseLayer: false, displayInLayerSwitcher: false
          });
          fire.setZIndex(999);
          olMap.addLayer(fire);
          capas_wms.push(fire);
          // console.log(fire.getProperties());
          }
  var layers = olMap.getLayers();
  var imgLegend = 'http://carto.icv.gva.es/arcgis/services/tm_medio_ambiente/prevencion_de_incendios/MapServer/WmsServer?service=wms&VERSION=1.0.0&request=GetLegendGraphic&FORMAT=image/png&LEGEND_OPTIONS=forceLabels:on&LAYER=';
  $scope.LoadLayerFires46 = function() { 
    layers.forEach(layer => {
      if (layer.getProperties().name == 'fire46') { 
        if (layer.getVisible()==false) { layer.setVisible(true); 
        document.getElementById('imageLegendLayer').src = imgLegend + '46';}
        else { layer.setVisible(false); } }
    });
  };
  $scope.LoadLayerFires47 = function() { 
    layers.forEach(layer => {
      if (layer.getProperties().name == 'fire47') { if (layer.getVisible()==false) { layer.setVisible(true); document.getElementById('imageLegendLayer').src = imgLegend + '47'; } else { layer.setVisible(false); } }
    });
  };
  $scope.LoadLayerFires48 = function() { 
    layers.forEach(layer => {
      if (layer.getProperties().name == 'fire48') { if (layer.getVisible()==false) { layer.setVisible(true); document.getElementById('imageLegendLayer').src = imgLegend + '48'; } else { layer.setVisible(false); } }
    });
  };
  $scope.LoadLayerFires49 = function() { 
    layers.forEach(layer => {
      if (layer.getProperties().name == 'fire49') { if (layer.getVisible()==false) { layer.setVisible(true); document.getElementById('imageLegendLayer').src = imgLegend + '49'; } else { layer.setVisible(false); } }
    });
  };
  $scope.LoadLayerFires50 = function() { 
    layers.forEach(layer => {
      if (layer.getProperties().name == 'fire50') { if (layer.getVisible()==false) { layer.setVisible(true); document.getElementById('imageLegendLayer').src = imgLegend + '50'; } else { layer.setVisible(false); } }
    });
  };
  $scope.LoadLayerFires51 = function() { 
    layers.forEach(layer => {
      if (layer.getProperties().name == 'fire51') { if (layer.getVisible()==false) { layer.setVisible(true); document.getElementById('imageLegendLayer').src = imgLegend + '51'; } else { layer.setVisible(false); } }
    });
  };
  $scope.LoadLayerFires52 = function() { 
    layers.forEach(layer => {
      if (layer.getProperties().name == 'fire52') { if (layer.getVisible()==false) { layer.setVisible(true); document.getElementById('imageLegendLayer').src = imgLegend + '52'; } else { layer.setVisible(false); } }
    });
  };
  $scope.LoadLayerFires53 = function() { 
    layers.forEach(layer => {
      if (layer.getProperties().name == 'fire53') { if (layer.getVisible()==false) { layer.setVisible(true); document.getElementById('imageLegendLayer').src = imgLegend + '53'; } else { layer.setVisible(false); } }
    });
  };
  $scope.LoadLayerFires54 = function() { 
    layers.forEach(layer => {
      if (layer.getProperties().name == 'fire54') { if (layer.getVisible()==false) { layer.setVisible(true); document.getElementById('imageLegendLayer').src = imgLegend + '54'; } else { layer.setVisible(false); } }
    });
  };
  $scope.LoadLayerFires55 = function() { 
    layers.forEach(layer => {
      if (layer.getProperties().name == 'fire55') { if (layer.getVisible()==false) { layer.setVisible(true); document.getElementById('imageLegendLayer').src = imgLegend + '55'; } else { layer.setVisible(false); } }
    });
  };
  $scope.LoadLayerFires56 = function() { 
    layers.forEach(layer => {
      if (layer.getProperties().name == 'fire56') { if (layer.getVisible()==false) { layer.setVisible(true); document.getElementById('imageLegendLayer').src = imgLegend + '56'; } else { layer.setVisible(false); } }
    });
  };
  $scope.LoadLayerFires57 = function() { 
    layers.forEach(layer => {
      if (layer.getProperties().name == 'fire57') { if (layer.getVisible()==false) { layer.setVisible(true); document.getElementById('imageLegendLayer').src = imgLegend + '57'; } else { layer.setVisible(false); } }
    });
  };
  $scope.LoadLayerFires58 = function() { 
    layers.forEach(layer => {
      if (layer.getProperties().name == 'fire58') { if (layer.getVisible()==false) { layer.setVisible(true); document.getElementById('imageLegendLayer').src = imgLegend + '58'; } else { layer.setVisible(false); } }
    });
  };
  $scope.LoadLayerFires59 = function() { 
    layers.forEach(layer => {
      if (layer.getProperties().name == 'fire59') { if (layer.getVisible()==false) { layer.setVisible(true); document.getElementById('imageLegendLayer').src = imgLegend + '59'; } else { layer.setVisible(false); } }
    });
  };
  $scope.LoadLayerFires60 = function() { 
    layers.forEach(layer => {
      if (layer.getProperties().name == 'fire60') { if (layer.getVisible()==false) { layer.setVisible(true); document.getElementById('imageLegendLayer').src = imgLegend + '60'; } else { layer.setVisible(false); } }
    });
  };
  $scope.LoadLayerFires61 = function() { 
    layers.forEach(layer => {
      if (layer.getProperties().name == 'fire61') { if (layer.getVisible()==false) { layer.setVisible(true); document.getElementById('imageLegendLayer').src = imgLegend + '61'; } else { layer.setVisible(false); } }
    });
  };
  $scope.LoadLayerFires62 = function() { 
    layers.forEach(layer => {
      if (layer.getProperties().name == 'fire62') { if (layer.getVisible()==false) { layer.setVisible(true); document.getElementById('imageLegendLayer').src = imgLegend + '62'; } else { layer.setVisible(false); } }
    });
  };
  $scope.LoadLayerFires63 = function() { 
    layers.forEach(layer => {
      if (layer.getProperties().name == 'fire63') { if (layer.getVisible()==false) { layer.setVisible(true); document.getElementById('imageLegendLayer').src = imgLegend + '63'; } else { layer.setVisible(false); } }
    });
  };
  $scope.LoadLayerFires64 = function() { 
    layers.forEach(layer => {
      if (layer.getProperties().name == 'fire64') { if (layer.getVisible()==false) { layer.setVisible(true); document.getElementById('imageLegendLayer').src = imgLegend + '64'; } else { layer.setVisible(false); } }
    });
  };
  $scope.LoadLayerFires65 = function() { 
    layers.forEach(layer => {
      if (layer.getProperties().name == 'fire65') { if (layer.getVisible()==false) { layer.setVisible(true); document.getElementById('imageLegendLayer').src = imgLegend + '65'; } else { layer.setVisible(false); } }
    });
  };
  $scope.LoadLayerFires66 = function() { 
    layers.forEach(layer => {
      if (layer.getProperties().name == 'fire66') { if (layer.getVisible()==false) { layer.setVisible(true); document.getElementById('imageLegendLayer').src = imgLegend + '66'; } else { layer.setVisible(false); } }
    });
  };
  $scope.LoadLayerFires67 = function() { 
    layers.forEach(layer => {
      if (layer.getProperties().name == 'fire67') { if (layer.getVisible()==false) { layer.setVisible(true); document.getElementById('imageLegendLayer').src = imgLegend + '67'; } else { layer.setVisible(false); } }
    });
  };
  $scope.LoadLayerFires68 = function() { 
    layers.forEach(layer => {
      if (layer.getProperties().name == 'fire68') { if (layer.getVisible()==false) { layer.setVisible(true); document.getElementById('imageLegendLayer').src = imgLegend + '68'; } else { layer.setVisible(false); } }
    });
  };
          // INIT CONTEXT MENU

var pin_icon = 'http://cdn.rawgit.com/jonataswalker/ol3-contextmenu/master/examples/img/pin_drop.png';
var center_icon = 'http://cdn.rawgit.com/jonataswalker/ol3-contextmenu/master/examples/img/center.png';
var list_icon = 'http://cdn.rawgit.com/jonataswalker/ol3-contextmenu/master/examples/img/view_list.png';

var contextmenu_items = [
  {
    text: 'Centrar aquí',
    classname: 'bold',
    icon: center_icon,
    callback: center
  },
  {
    text: 'Marcar',
    icon: pin_icon,
    callback: marker
  },
  '-' // this is a separator
];

var contextmenu = new ContextMenu({
  width: 180,
  items: contextmenu_items
});
olMap.addControl(contextmenu);

var removeMarkerItem = {
  text: 'Remove this Marker',
  classname: 'marker',
  callback: removeMarker
};

contextmenu.on('open', function (evt) {
  var feature =	olMap.forEachFeatureAtPixel(evt.pixel, ft => ft);
  
  if (feature && feature.get('type') === 'removable') {
    contextmenu.clear();
    removeMarkerItem.data = { marker: feature };
    contextmenu.push(removeMarkerItem);
  } else {
    contextmenu.clear();
    contextmenu.extend(contextmenu_items);
    contextmenu.extend(contextmenu.getDefaultItems());
  }
});

olMap.on('pointermove', function (e) {
  if (e.dragging) return;

  var pixel = olMap.getEventPixel(e.originalEvent);
  var hit = olMap.hasFeatureAtPixel(pixel);

  olMap.getTargetElement().style.cursor = hit ? 'pointer' : '';
});

function elastic(t) {
  return Math.pow(2, -10 * t) * Math.sin((t - 0.075) * (2 * Math.PI) / 0.3) + 1;
}

function center(obj) {
  olMap.getView().animate({
    duration: 700,
    easing: elastic,
    center: obj.coordinate
  });
}

function removeMarker(obj) {
  vectorLayer.getSource().removeFeature(obj.data.marker);
}

function marker(obj) {
  var coord4326 = ol.proj.transform(obj.coordinate, 'EPSG:3857', 'EPSG:3857'),
      template = 'Coordinate is ({x} | {y})',
      iconStyle = new ol.style.Style({
        image: new ol.style.Icon({ scale: .6, src: pin_icon }),
        text: new ol.style.Text({
          offsetY: 25,
          text: ol.coordinate.format(coord4326, template, 2),
          font: '15px Open Sans,sans-serif',
          fill: new ol.style.Fill({ color: '#111' }),
          stroke: new ol.style.Stroke({ color: '#eee', width: 2 })
        })
      }),
      feature = new ol.Feature({
        type: 'removable',
        geometry: new ol.geom.Point(obj.coordinate)
      });

  feature.setStyle(iconStyle);
  vectorLayer.getSource().addFeature(feature);
}
  // END CONTEXT MENU
  // Bounce easing (custom)
	var bounce = 3;
	var a = (2*bounce+1) * Math.PI/2;
	var b = -0.01;
	var c = -Math.cos(a) * Math.pow(2, b);
	ol.easing.bounce = function(t)
	{	t = 1-Math.cos(t*Math.PI/2);
		return (1 + Math.abs( Math.cos(a*t) ) * Math.pow(2, b*t) + c*t)/2;
	}
	
	function pulseFeature(coord2)
	{	var f = new ol.Feature (new ol.geom.Point(coord2));
		f.setStyle (new ol.style.Style(
					{	image: new ol.style.Circle (
						{	radius: 30, 
							points: 4,
							src: "data/smile.png",
							stroke: new ol.style.Stroke ({ color: "#00d8ff", width:2 })
						})
					}));
		olMap.animateFeature(f, new ol.featureAnimation.Zoom(
			{	fade: ol.easing.easeOut, 
				duration:3000, 
				easing: ol.easing[$("#easing").val()]
			}));
	}

	function pulse(coord)
	{	var nb = $("#easing").val()=='bounce' ? 1:3;
		for (var i=0; i<nb; i++)
		{	setTimeout (function()
			{ var coord2 = coord;	pulseFeature (coord2);
			}, i*500);
		};
	}

        // INIT GEOCODER
        var geocoder = new Geocoder('nominatim', {
          provider: 'osm',
          key: '__some_key__',
          lang: 'es', //en-US, fr-FR
          placeholder: 'Search...',
          targetType: 'text-input',
          limit: 5,
          keepOpen: true,
          autoComplete: true,
        });
        olMap.addControl(geocoder);
        
        //Listen when an address is chosen
        geocoder.on('addresschosen', function (evt) {      
            window.setTimeout(function () {
              olMap.getView().setZoom(12);        
            }, 1000);         
        });
        // END GEOCODER
        //INIT IDENTIFICAR
        function identificar(evt){
          if (capas_wms){
          for (var i=0;i<capas_wms.length;i++){
              if(capas_wms[i].get('visible')==true){
              var layerName = capas_wms[i].I.title;
              var viewResolution =  (olMap.getView().getResolution());
              var url = capas_wms[i].getSource().getGetFeatureInfoUrl( evt.coordinate, viewResolution, 'EPSG:3857', {'INFO_FORMAT': 'application/geojson'});				  	
              var info = '';
              var container = document.getElementById('info');
                  if (url) {
                    $http({  
                    method : "GET",
                    url : url,
                    data: {
                            service: 'WMS',
                            version: '1.3.0',
                            request: 'GetFeature',
                            outputFormat:'application/geojson',
                        },
                    }).then(function mySuccess(response) {
                      var feature = response.data.features[0];
                      if (feature != undefined) {
                        var properties = feature.properties;
                        console.log(properties);
                        var geometry = feature.geometry;
                        console.log(layerName);
                        if (layerName == 'ZonasActuacionUrgente') {
                          var name = properties.Nombre;
                          var area = properties.Áreaha;
                          info = name;
                        }
                        if (layerName = 'PlanesLocalesQuemas') {
                          var municipio = properties.Municipio;
                          info = municipio;
                        }
                        
                        $mdToast.show($mdToast.simple().textContent(info).position('bottom right').hideDelay(3000));
                      }
                      }, function myError(response) {
                          console.log(response);
                    });
                  }
          }
                  }
          }
          if (capas_geoserver){			
            for (var i=0;i<capas_geoserver.length;i++){
                if(capas_geoserver[i].get('visible')==true){  
                var viewResolution =  (olMap.getView().getResolution());
                var url = capas_geoserver[i].getSource().getGetFeatureInfoUrl( evt.coordinate, viewResolution, 'EPSG:25830', {'INFO_FORMAT': 'application/json'});				  	
                var info = '';
                var container = document.getElementById('info');
                    if (url) {
                $http({  
                method : "GET",
                url : url,
                data: {
                        service: 'WMS',
                        version: '1.1.0',
                        request: 'GetFeatureInfo',
                        maxFeatures: 50,
                        outputFormat:'application/json'
                    },
                headers: {'Content-Type': 'application/json'}
              }).then(function mySuccess(response) {
                TextInfo.innerHTML = "";
                  var feature = response.data.features[0];
                  if (feature != undefined) {
                    var properties = feature.properties;
                    var geometry = feature.geometry;
                    for (var i in properties) {

                      TextInfo.innerHTML += ""+i+": "+properties[i]+"<br>";
                      if (i = "target") {
                        coor.innerHTML = properties[i];
                      }
                      if (i = "name") {
                        street.innerHTML = properties[i];
                      }

                    }
                  } else {
                  }
                }, function myError(response) {
                    console.log(response);
              });
            }
            }
                    }
            }

          }
          // FIN IDENTIFICAR
     }]);
 
  </script>
</body>

</html>
